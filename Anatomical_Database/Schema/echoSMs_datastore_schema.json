{
    "$id": "https://example.com/anatomical.echosms.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "EchoSMs anatomical datastore schema",
    "description": "This schema defines a structure for storing fish and plankton acoustic scattering model data, mainly for input to the echoSMs anatomical datastore.\n\nA dataset is a set of xyz coordinates for an anatomical feature.\n\nThe reference version of the schema (formatted as a JSON-schema file) will always be available in the echoSMs github [repository](https://github.com/ices-tools-dev/echoSMs/tree/main/data_store/schema/v1).",
    "type": "object",
    "required": [
        "anatomical_category",
        "anatomical_feature",
        "aphia_id",
        "boundary",
        "dataset_id",
        "dataset_size",
        "dataset_size_units",
        "date_collection",
        "date_created",
        "date_image",
        "date_last_modified",
        "description",
        "imaging_method",
        "shape_method",
        "shape_type",
        "shape_units",
        "specimen_condition",
        "specimen_id",
        "shape_data"
    ],
    "additionalProperties": false,
    "dependentRequired": {
        "latitude": [
            "latitude_units"
        ],
        "longitude": [
            "longitude_units"
        ],
        "depth": [
            "depth_units"
        ]
    },
    "properties": {
        "anatomical_category": {
            "description": "The type of anatomy that this dataset contains.",
            "type": "string",
            "enum": [
                "tissue",
                "organ",
                "organ system",
                "organism",
                "other"
            ]
        },
        "anatomical_feature": {
            "description": "The type of anatomical feature in this dataset.",
            "type": "string",
            "enum": [
                "body",
                "swimbladder",
                "backbone",
                "muscle",
                "other"
            ]
        },
        "aphia_id": {
            "type": "integer",
            "minimum": 1,
            "description": "The WoRMS [aphiaID](https://www.marinespecies.org/aphia.php) of the species in this dataset."
        },
        "boundary": {
            "description": "Type of reflecting boundary for this shape.",
            "type": "string",
            "enum": [
                "hard",
                "soft",
                "fluid"
            ]
        },
        "dataset_id": {
            "description": "A unique identifier for this dataset, generated by the data storage system.",
            "type": "string"
        },
        "dataset_size": {
            "description": "Size of the entire dataset (including raw data) (MiB). Generated by the data store server.",
            "type": "number",
            "minimum": 0
        },
        "dataset_size_units": {
            "description": "Units for dataset_size.",
            "type": "string",
            "enum": [
                "megabyte"
            ]
        },
        "date_collection": {
            "description": "The date or date range when the dataset was collected, in [RFC9557](https://datatracker.ietf.org/doc/rfc9557) format.",
            "type": "string",
            "format": "date"
        },
        "date_created": {
            "type": "string",
            "format": "date",
            "description": "The date when these metadata were first created, in [RFC9557](https://datatracker.ietf.org/doc/rfc9557) format."
        },
        "date_image": {
            "description": "The date when the dataset was imaged, in [RFC9557](https://datatracker.ietf.org/doc/rfc9557) format.",
            "type": "string",
            "format": "date"
        },
        "date_last_modified": {
            "type": "string",
            "format": "date",
            "description": "The date when these metadata were last modified, in [RFC9557](https://datatracker.ietf.org/doc/rfc9557) format."
        },
        "description": {
            "type": "array",
            "description": "A description of the dataset. It can be a list of strings"
        },
        "imaging_method": {
            "description": "Method used to obtain the raw image data.",
            "type": "string",
            "enum": [
                "radiograph",
                "CT",
                "MRI",
                "photograph",
                "3D scanner",
                "unknown",
                "other",
                "not applicable"
                ]
        },
        "shape_method": {
            "description": "Method used to obtain the anatomical feature's shape.",
            "type": "string",
            "enum": [
                "manual outline of image(s)",
                "automated outline of image(s)",
                "3D scan of object",
                "not applicable",
                "unknown",
                "other"
            ]
        },
        "shape_type": {
            "description": "Type of shape data. These need to match those in shape_data",
            "type": "string",
            "enum": [
                "outline",
                "surface",
                "voxels",
                "categorised voxels"
            ]
        },
        "shape_units": {
            "description": "Units of measurement for the shape.",
            "type": "string",
            "enum": [
                "millimeter",
                "centimeter",
                "meter",
                "inch"
            ]
        },
        "specimen_condition": {
            "description": "Condition of the specimen when it was imaged.",
            "type": "string",
            "enum": [
                "fresh",
                "frozen",
                "thawed",
                "unknown",
                "other"
            ]
        },
        "specimen_id": {
            "description": "A name that uniquely identifies each specimen in a dataset.",
            "type": "string"
        },
        "activity_name": {
            "description": "Name of the data collection activity (if any), such as voyage code, project name, etc.",
            "type": "string"
        },
        "data_collection_description": {
            "description": "Description of data collection details.",
            "type": "string"
        },
        "depth": {
            "description": "Depth below surface of organism collection location (m).",
            "type": "number",
            "minimum": 0
        },
        "investigators": {
            "description": "Names or identifying descriptions of person(s) or organisation(s) that created this dataset.",
            "type": "array",
            "items": {
            "type": "string"
            }
        },
        "image_files": {
            "description": "File names of the analog images, e.g., silhouettes, radiograph images.",
            "type": "string"
        },
        "latitude": {
            "description": "Latitude of location where organism was collected (decimal degrees).",
            "type": "number",
            "minimum": -90,
            "maximum": 90
        },
        "longitude": {
            "description": "Longitude of location where organism was collected (decimal degrees).",
            "type": "number",
            "minimum": -180,
            "maximum": 180
        },
        "location": {
            "description": "Name or description of the location where organism was collected.",
            "type": "string"
        },
        "mass_density": {
            "description": "Mass density of shape (kg/m³).",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "number",
                "minimum": 0
            }
        },
        "mass_density_ratio": {
            "description": "Ratio of mass densities of the shape and the surrounding material or shape. Also referred to as 'g'.",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "number",
                "minimum": 0
            }
        },
        "mass_density_method": {
            "description": "Method used to obtain density in the feature.",
            "type": "string",
            "enum": [
                "CT density",
                "liquid displacement",
                "literature",
                "unknown",
                "other"
            ]
        },
        "model_type": {
            "description": "Original scattering model type.",
            "type": "string",
            "enum": [
                "KRM",
                "KA",
                "DWBA",
                "PTDWBA",
                "FEM",
                "BEM",
                "MFS",
                "unknown",
                "other"
            ]
        },
        "notes": {
            "$ref": "#/$defs/notes"
        },
        "radiograph_settings": {
            "description": "Settings used to image the anatomical feature using radiography. The top-level key is the perspective (the viewpoint of the imaging x-ray machine to the anatomical feature), usually lateral or dorsal",
            "type": "object",
            "properties": {
                "perspective": {
                    "description": "The viewpoint of the imaging x-ray machine to the anatomical feature.",
                    "type": "object",
                    "enum": [
                        "lateral",
                        "dorsal",
                        "other"
                    ],
                    "additionalProperties": false,
                    "properties": {
                        "exposure_time": {
                            "description": "The exposure time setting of the imaging x-ray machine.",
                            "type": "string"
                        },
                        "exposure_time_unit": {
                            "description": "Unit of exposure time.",
                            "type": "string",
                            "enum": [
                                "second",
                                "minute",
                                "hour"
                            ]
                        },
                        "focal_length": {
                            "description": "Focal length setting of the imaging x-ray machine.",
                            "type": "string"
                        },
                        "focal_length_unit": {
                            "description": "Unit of focal length.",
                            "type": "string",
                            "enum": [
                                "millimeter",
                                "centimeter",
                                "meter",
                                "inch"
                            ]
                        },
                        "kVp": {
                            "description": "The kilovoltage peak setting of the imaging x-ray machine.",
                            "type": "string"
                        },
                        "MA": {
                            "description": "The milliamperage setting of the imaging x-ray machine.",
                            "type": "string"
                        }
                    }
                }
            }
        },
        "reference": {
            "description": "A literature reference for the dataset. If available, a DOI or URI is recommended.",
            "type": "string"
        },
        "rotate": {
            "description": "Boolean whether the shape was rotated.",
            "type": "boolean",
            "default": false
        },
        "rotate_method": {
            "description": "Method used to rotate",
            "type": "string"
        },
        "shape_method_processing": {
            "description": "Description of processing used to convert raw images into shapes, including any manipulation of image data (for example, smoothing, edge enhancement, rotation, etc).",
            "type": "string"
        },
        "smooth": {
            "description": "Boolean whether the shape was smoothed.",
            "type": "boolean",
            "default": false
        },
        "smooth_method": {
            "description": "Method used to smooth the shape",
            "type": "string"
        },
        "straighten": {
            "description": "Boolean whether the shape was straightenedt.",
            "type": "boolean",
            "default": false
        },
        "straighten_method": {
            "description": "Method used to straighten the shape",
            "type": "string"
        },
        "sound_speed_method": {
            "description": "Method used to obtain sound speed in the feature.",
            "type": "string",
            "enum": [
                "density to sound speed relationship",
                "time-of-flight",
                "literature",
                "unknown",
                "other"
            ]
        },
        "sound_speed_compressional": {
            "description": "Compressional sound speed in shape (m/s).",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "number",
                "minimum": 0
            }
        },
        "sound_speed_ratio": {
            "description": "Ratio of compressional sound speed of the and the surrounding material or shape. Also referred to as 'h'.",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "number",
                "minimum": 0
            }
        },
        "sound_speed_shear": {
            "description": "Transversal (shear) sound speed in shape (m/s).",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "number",
                "minimum": 0
            }
        },
        "specimen_class": {
            "type": "string",
            "description": "Taxonomical hierarchy level of class that is consistent with WoRMS."
        },
        "specimen_order": {
            "description": "Taxonomical hierarchy level of order that is consistent with WoRMS.",
            "type": "string"
        },
        "specimen_family": {
            "description": "Taxonomical hierarchy level of family that is consistent with WoRMS.",
            "type": "string"
        },
        "specimen_genus": {
            "description": "Taxonomical hierarchy level of genus that is consistent with WoRMS.",
            "type": "string"
        },
        "specimen_species": {
            "description": "Taxonomical hierarchy level of species that is consistent with WoRMS.",
            "type": "string"
        },
        "specimen_length": {
            "description": "Length of the specimen (m).",
            "type": "number",
            "minimum": 0
        },
        "specimen_length_type": {
            "description": "Type of length measurement.",
            "type": "string",
            "enum": [
                "total length",
                "fork length",
                "standard length",
                "lower jaw fork length",
                "total width",
                "carapace length",
                "curved fork length",
                "disc width",
                "stretched total length",
                "CCAMLR krill - front of eye to tip of telson",
                "unknown",
                "other"
            ]
        },
        "specimen_length_unit": {
            "description": "Unit of length measurement.",
            "type": "string",
            "enum": [
                "millimeter",
                "centimeter",
                "meter",
                "inch"
            ]
        },
        "specimen_sex": {
            "description": "Sex of specimen",
            "type": "string",
            "enum": [
                "female",
                "male",
                "immature",
                "unknown"
            ]
        },
        "specimen_weight": {
            "description": "Weight of the specimen (kg).",
            "type": "number",
            "minimum": 0
        },
        "specimen_vernaculars": {
            "description": "Vernacular names for the organism.",
            "type": "array"
        },
        "youngs_modulus": {
            "description": "Young's modulus, E, of the shape (Pa).",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "number",
                "minimum": 0
            }
        },
        "shape_data": {
            "description": "Shape data.",
            "type": "object",
            "unevaluatedProperties": false,
            "oneOf": [
                {
                    "description": "Outline coordinates.",
                    "type": "object",
                    "required": [
                        "x",
                        "y",
                        "z",
                        "height",
                        "width"
                    ],
                    "additionalProperties": false,
                    "properties": {
                        "shape_type": {
                            "description": "This must match shape_type.",
                            "const": "outline"
                        },
                        "x": {
                            "description": "x-coordinate of shape centreline (m).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        },
                        "y": {
                            "description": "y-coordinate of shape centreline (m).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        },
                        "z": {
                            "description": "z-coordinate of shape centreline (m).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        },
                        "height": {
                            "description": "Height of the shape at each centreline point (m).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number",
                                "minimum": 0
                            }
                        },
                        "width": {
                            "description": "Width of the shape at each centreline point (m).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number",
                                "minimum": 0
                            }
                        }
                    }
                },
                {
                    "description": "Surface coordinates for 2D models.",
                    "required": [
                        "x",
                        "y",
                        "z",
                        "facets_0",
                        "facets_1",
                        "facets_2",
                        "normals_x",
                        "normals_y",
                        "normals_z"
                    ],
                    "properties": {
                        "shape_type": {
                            "description": "This must match shape_type.",
                            "const": "surface"
                        },
                        "x": {
                            "description": "x-coordinates of surface nodes (m).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        },
                        "y": {
                            "description": "y-coordinates of surface nodes (m).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        },
                        "z": {
                            "description": "z-coordinates of surface nodes (m).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        },
                        "facets_0": {
                            "description": "Zero-based indices into x, y, and z that define node 0 of a surface triangle.",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                            "type": "integer",
                                "minimum": 0
                            }
                        },
                        "facets_1": {
                            "description": "Zero-based indices into x, y, and z that define node 1 of a surface triangle.",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "integer",
                                "minimum": 0
                            }
                        },
                        "facets_2": {
                            "description": "Zero-based indices into x, y, and z that define node 2 of a surface triangle.",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "integer",
                                "minimum": 0
                            }
                        },
                        "normals_x": {
                            "description": "x-component of outward-pointing normal vector for each facet.",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        },
                        "normals_y": {
                            "description": "y-component of outward-pointing normal vector for each facet.",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        },
                        "normals_z": {
                            "description": "z-component of outward-pointing normal vector for each facet.",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "number"
                            }
                        }
                    }
                },
                {
                    "description": "Voxels for 3D models.",
                    "required": [
                        "voxel_mass_density",
                        "voxel_sound_speed_compressional",
                        "voxel_size"
                        ],
                    "properties": {
                        "shape_type": {
                            "description": "This must match shape_type.",
                            "const": "voxels"
                        },
                        "voxel_mass_density": {
                            "$ref": "#/$defs/voxel_mass_density"
                        },
                        "voxel_sound_speed_compressional": {
                            "$ref": "#/$defs/voxel_sound_speed_compressional"
                        },
                        "voxel_size": {
                            "$ref": "#/$defs/voxel_size"
                        }
                    }
                },
                {
                    "description": "Categorised voxels for 3D models.",
                    "required": [
                        "categories",
                        "voxel_mass_density",
                        "voxel_sound_speed_compressional",
                        "voxel_size"
                    ],
                    "properties": {
                        "shape_type": {
                            "description": "This must match shape_type.",
                            "const": "categorised voxels"
                        },
                        "categories": {
                            "description": "Voxel categories",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "array",
                                "minItems": 1,
                                "items": {
                                    "type": "array",
                                    "minItems": 1,
                                    "items": {
                                       "type": "integer"
                                    }
                                }
                            }
                        },
                        "voxel_mass_density": {
                            "$ref": "#/$defs/voxel_mass_density"
                        },
                        "voxel_sound_speed_compressional": {
                            "$ref": "#/$defs/voxel_sound_speed_compressional"
                        },
                        "voxel_size": {
                            "$ref": "#/$defs/voxel_size"
                        }
                    }
                }
            ]
        }
    },
    "$defs": {
        "notes": {
            "description": "Explanatory notes about the shape data, i.e., comments.",
            "type": "string"
        },
        "voxel_mass_density": {
            "description": "Mass density of voxels (kg/m³).",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "array",
                "minItems": 1,
                "items": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "number",
                        "minimum": 0
                    }
                }
            }
        },
        "voxel_sound_speed_compressional": {
            "description": "Compressional sound speed of voxels (m/s).",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "array",
                "minItems": 1,
                "items": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "number",
                        "minimum": 0
                    }
                }
            }
        },
        "voxel_size": {
            "description": "Voxel size, ordered x, y, z (m).",
            "type": "array",
            "minItems": 3,
            "maxItems": 3,
            "items": {
                "type": "number",
                "minimum": 0
            }
        }
    }
}

